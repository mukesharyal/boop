import{f as V,r as i,j as t,d as C,C as U,c as N,g as T,h as Y,e as q,i as z}from"./index-BkPeKK39.js";const K="_chatContainer_1ymfh_1",Q="_chatBottom_1ymfh_16",F={chatContainer:K,chatBottom:Q},W="_textMessage_1h77m_1",Z="_receivedMessage_1h77m_16",ee="_hasReaction_1h77m_16",te="_sentMessage_1h77m_20",se="_topMessage_1h77m_45",ne="_bottomMessage_1h77m_50",oe="_sending_1h77m_70",ce="_sent_1h77m_20",ae="_repliedMessage_1h77m_87",ie="_deletedMessage_1h77m_91",d={textMessage:W,receivedMessage:Z,hasReaction:ee,sentMessage:te,topMessage:se,bottomMessage:ne,sending:oe,sent:ce,repliedMessage:ae,deletedMessage:ie},re="_reaction_1hg6b_1",le="_sentReaction_1hg6b_11",de="_receivedReaction_1hg6b_16",w={reaction:re,sentReaction:le,receivedReaction:de},he=["👍","❤️","😆","😮","😢","😡"];function ge({reaction:o,origin:n}){const[c,h]=V(()=>({scale:1}));return i.useEffect(()=>{h.start({from:{scale:0},to:{scale:1},config:{tension:300,friction:15}})},[o]),o!==-1?t.jsx(C.span,{className:`${w.reaction} ${n==="sent"?w.sentReaction:w.receivedReaction}`,style:{...c},children:he[o]}):t.jsx(t.Fragment,{})}function D({type:o,sentId:n,origin:c,content:h,reaction:m,prevMessage:g,nextMessage:f,status:e,receivedId:s,index:a,reply:v,deleted:u,highlight:j}){if(u===1)return t.jsx(t.Fragment,{});const[I,_]=V(()=>({scale:1,x:0})),{dataChannel:$}=i.useContext(U),r=i.useRef(null),M=i.useRef(!1),y=i.useRef(!0),R=i.useRef(0),{chatBottom:L,pointerPosition:E,setActionsShown:O,setReactionsShown:X,setSelectedMessageId:B,setReplying:k,longPressed:S,messages:A,atBottomRef:P}=i.useContext(N);i.useEffect(()=>{console.log("The value of highlight changed!"),_.start({from:{scale:0,opacity:0},to:[{scale:1,opacity:1}],config:{duration:200}})},[]),i.useEffect(()=>{if(y.current){y.current=!1;return}_.start({from:{scale:1},to:[{scale:1.3},{scale:1}],config:T.stiff,onStart:P?()=>{L.current.scrollIntoView({behavior:"smooth"}),P.current=!1}:null})},[j]);const G=()=>{const l=A[a];if("receivedId"in l&&l.reaction!==1){let p={type:"reaction",id:l.receivedId,reaction:1};$.current.send(JSON.stringify(p))}},H=Y({onPointerDown:({event:l})=>{M.current=!1,r.current=setTimeout(()=>{M.current||(E.current.x=l.clientX,E.current.y=l.clientY,S.current=!0,_.start({from:{scale:1},to:[{scale:.95},{scale:1.025},{scale:1}],config:{tension:600,friction:12,duration:100}}),O(!0),c!=="sent"&&X(!0),B(a))},500)},onPointerUp:()=>{setTimeout(()=>{S.current=!1},100),clearTimeout(r.current);const l=Date.now();l-R.current<500?(G(),R.current=0):R.current=l},onPointerLeave:()=>{clearTimeout(r.current)},onDrag:({last:l,movement:[p]})=>{if(Math.abs(p)<5)return;M.current=Math.abs(p)>5,Math.abs(p)>60&&(B(a),k(!0));let J=c==="sent"?Math.min(0,p):Math.max(0,p);_.start({x:J}),M.current&&r.current&&(clearTimeout(r.current),r.current=null),l&&_.start({x:0,config:{tension:500,friction:20}})}},{eventOptions:{passive:!1}});return t.jsxs(C.div,{...u===0?H():{},style:{...I},id:a,"data-sent-id":n,"data-received-id":s,"data-index":a,className:`
        ${d.textMessage}
        ${e==="sending"?d.sending:d.sent}
        ${c==="sent"?d.sentMessage:d.receivedMessage}
        ${(f==null?void 0:f.origin)===c?d.topMessage:""}
        ${(g==null?void 0:g.origin)===c?d.bottomMessage:""}
        ${m!==-1&&u!==2?d.hasReaction:""}
        ${v?d.repliedMessage:""}
        ${u===2?d.deletedMessage:""}
      `,children:[t.jsx("p",{children:o==="text"?h:t.jsx("img",{src:h})}),u!==2&&t.jsx(ge,{reaction:m,origin:c})]})}const ue="_replyToMessage_1hbbr_1",fe="_sentMessage_1hbbr_20",_e="_receivedMessage_1hbbr_25",x={replyToMessage:ue,sentMessage:fe,receivedMessage:_e};function pe({sentId:o,origin:n,content:c,reaction:h,status:m,receivedId:g,index:f,reply:e,deleted:s,nextMessage:a,highlight:v}){const{messages:u,setMessages:j}=i.useContext(N),I=e.receivedId?u.findIndex(r=>r.receivedId===e.receivedId):u.findIndex(r=>r.sentId===e.sentId),_=u[I],$=()=>{document.getElementById(`${I}`).scrollIntoView({behavior:"instant"}),setTimeout(()=>{j(M=>M.map((y,R)=>R===I?{...y,highlight:!y.highlight}:y))},100)};return t.jsxs(t.Fragment,{children:[t.jsx("a",{onClick:$,className:`
                        ${x.replyToMessage}
                        ${n==="sent"?x.sentMessage:x.receivedMessage}
                        ${h?x.hasReaction:""}
                      `,children:t.jsx("p",{children:_.content})}),t.jsx(D,{index:f,sentId:o,receivedId:g,status:m,origin:n,content:c,reaction:h,reply:!0,deleted:s,nextMessage:a,highlight:v},f)]})}const me="_typingIndicator_1aw03_1",Me="_dot_1aw03_13",b={typingIndicator:me,dot:Me};function ye({style:o}){return t.jsxs(C.div,{className:b.typingIndicator,style:{...o,width:o.width.to(n=>`${n}rem`),height:o.height.to(n=>`${n}rem`)},children:[t.jsx("span",{className:b.dot}),t.jsx("span",{className:b.dot}),t.jsx("span",{className:b.dot})]})}function Ie(){const{messages:o,chatBottom:n,newMessage:c,setNewMessage:h,typing:m}=i.useContext(N),g=i.useRef(null),f=q(m,{from:{width:0,height:0,opacity:0},enter:{width:4,height:2.1,opacity:1,config:T.stiff},leave:{width:0,height:0,opacity:0,config:T.stiff},onRest:()=>{z(n)&&n.current.scrollIntoView({behavior:"smooth"})}});return i.useLayoutEffect(()=>{const e=new IntersectionObserver(a=>{a.forEach(v=>{v.isIntersecting&&c&&h(!1)})},{threshold:.1}),s=g.current;return s&&e.observe(s),n.current=g.current,()=>{s&&e.unobserve(s)}},[c]),t.jsxs("div",{className:F.chatContainer,children:[o.map((e,s,a)=>e.reply?t.jsx(pe,{index:s,sentId:e.sentId,receivedId:e.receivedId,type:e.type,status:e.status,origin:e.origin,content:e.content,reaction:e.reaction,reply:e.reply,nextMessage:a[s+1],deleted:e.deleted,highlight:e.highlight},s):t.jsx(D,{index:s,sentId:e.sentId,receivedId:e.receivedId,type:e.type,status:e.status,origin:e.origin,content:e.content,reaction:e.reaction,prevMessage:a[s-1],nextMessage:a[s+1],deleted:e.deleted,highlight:e.highlight},s)),f((e,s)=>s?t.jsx(ye,{style:e}):null),t.jsx("div",{ref:g,className:F.chatBottom},"chatBottom")]})}export{Ie as default};
