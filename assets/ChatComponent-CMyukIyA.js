import{f as A,r as o,j as e,d as $,C as J,c as I,b as Q,g as v,h as W,e as O,i as Z}from"./index-CkWY4Y1x.js";const ee="_chatContainer_4p2h9_1",se="_chatBottom_4p2h9_16",V={chatContainer:ee,chatBottom:se},te="_textMessage_ic4g0_1",ne="_sentMessage_ic4g0_36",ie="_topMessage_ic4g0_41",ce="_bottomMessage_ic4g0_46",oe="_receivedMessage_ic4g0_51",ae="_sending_ic4g0_66",re="_sent_ic4g0_36",le="_repliedMessage_ic4g0_83",de="_deletedMessage_ic4g0_87",ge="_hasReaction_ic4g0_93",ue="_hasImage_ic4g0_97",d={textMessage:te,sentMessage:ne,topMessage:ie,bottomMessage:ce,receivedMessage:oe,sending:ae,sent:re,repliedMessage:le,deletedMessage:de,hasReaction:ge,hasImage:ue},he="_reaction_1hg6b_1",fe="_sentReaction_1hg6b_11",pe="_receivedReaction_1hg6b_16",S={reaction:he,sentReaction:fe,receivedReaction:pe},_e=["👍","❤️","😆","😮","😢","😡"];function me({reaction:c,origin:s}){const[n,r]=A(()=>({scale:1}));return o.useEffect(()=>{r.start({from:{scale:0},to:{scale:1},config:{tension:300,friction:15}})},[c]),c!==-1?e.jsx($.span,{className:`${S.reaction} ${s==="sent"?S.sentReaction:S.receivedReaction}`,style:{...n},children:_e[c]}):e.jsx(e.Fragment,{})}const xe="_requestDiv_1le1e_2",Me="_decisionBox_1le1e_10",je="_loading_1le1e_36",D={requestDiv:xe,decisionBox:Me,loading:je};function ye({index:c,sentId:s,receivedId:n}){const{dataChannel:r,peerName:f}=o.useContext(J),{setMessages:g,receivingImage:u}=o.useContext(I),{showNotification:i}=Q(),[t,a]=o.useState(!1),h=()=>{u.current===null?(r.current.send(JSON.stringify({type:"imageAccept",sentId:n,receivedId:s})),a(!0)):i("Please wait for a while!")},N=()=>{r.current.send(JSON.stringify({type:"imageReject",sentId:n,receivedId:s})),g(w=>{const M=[...w];return M.splice(c,1),M})};return t?e.jsxs("div",{className:D.loading,children:[e.jsx("span",{children:"L"}),e.jsx("span",{children:"o"}),e.jsx("span",{children:"a"}),e.jsx("span",{children:"d"}),e.jsx("span",{children:"i"}),e.jsx("span",{children:"n"}),e.jsx("span",{children:"g"}),e.jsx("span",{children:" "}),e.jsx("span",{children:"i"}),e.jsx("span",{children:"m"}),e.jsx("span",{children:"a"}),e.jsx("span",{children:"g"}),e.jsx("span",{children:"e"})]}):e.jsxs("div",{className:D.requestDiv,children:[e.jsxs("div",{children:[f.current," wants to send you an image"]}),e.jsxs("div",{className:D.decisionBox,children:[e.jsx("button",{onClick:h,children:"Accept"}),e.jsx("button",{onClick:N,children:"Reject"})]})]})}function H({index:c,prevMessage:s,nextMessage:n,message:r,replied:f}){const{dataChannel:g}=o.useContext(J),{chatBottom:u,pointerPosition:i,setActionsShown:t,setReactionsShown:a,setSelectedMessageId:h,setReplying:N,longPressed:w,atBottomRef:M}=o.useContext(I),{sentId:p,receivedId:m,type:T,status:E,content:P,reaction:B,deleted:j,highlight:U}=r,X={text:()=>e.jsxs("p",{children:[" ",P," "]}),image:()=>e.jsxs("p",{children:[" ",e.jsx("img",{src:P})," "]}),imageRequest:()=>e.jsx(ye,{index:c,sentId:p,receivedId:m})};if(j===1)return e.jsx(e.Fragment,{});const[G,y]=A(()=>({scale:1,x:0})),x=o.useRef(null),R=o.useRef(!1),k=o.useRef(!0),q=o.useRef(0),L=o.useRef(null);o.useEffect(()=>{M.current&&(u.current.scrollIntoView({behavior:"smooth"}),M.current=!1),y.start({from:{scale:0,opacity:0},to:[{scale:1,opacity:1}],reset:!1,config:v.stiff})},[]),o.useEffect(()=>{if(k.current){k.current=!1;return}(async()=>(L.current.scrollIntoView({behavior:"instant"}),await new Promise(l=>setTimeout(l,100)),y.start({from:{scale:1},to:[{scale:1.2},{scale:1}],config:v.stiff})))()},[U]);const Y=()=>{if(p===null&&B!==1){let l={type:"reaction",id:m,reaction:1};g.current.send(JSON.stringify(l))}},z=W({onPointerDown:({event:l})=>{R.current=!1,x.current=setTimeout(()=>{R.current||(i.current.x=l.clientX,i.current.y=l.clientY,w.current=!0,y.start({from:{scale:1},to:[{scale:1.1},{scale:1}],config:v.stiff}),t(!0),p===null&&a(!0),h(c))},500)},onPointerUp:()=>{setTimeout(()=>{w.current=!1},100),clearTimeout(x.current);const l=Date.now();l-q.current<500?(Y(),q.current=0):q.current=l},onPointerLeave:()=>{clearTimeout(x.current)},onDrag:({last:l,movement:[_]})=>{if(p===null){if(_<0)return}else if(_>0)return;if(Math.abs(_)<5)return;R.current=Math.abs(_)>5,Math.abs(_)>60&&(h(c),N(!0));let K=m===null?Math.min(0,_):Math.max(0,_);y.start({x:K}),R.current&&x.current&&(clearTimeout(x.current),x.current=null),l&&y.start({x:0,config:{tension:500,friction:20}})}},{eventOptions:{passive:!1}});return e.jsxs($.div,{ref:L,...j!==0||T==="imageRequest"||E==="sending"?{}:z(),style:{...G},className:`
        ${d.textMessage}
        ${E==="sending"?d.sending:d.sent}
        ${m===null?d.sentMessage:d.receivedMessage}
        ${(n==null?void 0:n.sentId)===p||(n==null?void 0:n.receivedId)===m?d.topMessage:""}
        ${(s==null?void 0:s.sentId)===p||(s==null?void 0:s.receivedId)===m?d.bottomMessage:""}
        ${f?d.repliedMessage:""}
        ${j===2?d.deletedMessage:""}
        ${B!==-1&&j!==2?d.hasReaction:""}
        ${T==="image"?d.hasImage:""}
      `,children:[(X[T]||(()=>e.jsx("p",{children:e.jsx("span",{children:"Unknown type"})})))(),j!==2&&e.jsx(me,{reaction:B,origin:p===null?"received":"sent"})]})}const ve="_replyToMessage_1hbbr_1",Ie="_sentMessage_1hbbr_20",we="_receivedMessage_1hbbr_25",b={replyToMessage:ve,sentMessage:Ie,receivedMessage:we};function Re({index:c,nextMessage:s,message:n}){const{messages:r,setMessages:f}=o.useContext(I),g=r.findIndex(t=>t.receivedId===n.replyTo.receivedId&&t.sentId===n.replyTo.sentId),u=r[g],i=()=>{setTimeout(()=>{f(t=>t.map((a,h)=>h===g?{...a,highlight:!a.highlight}:a))},100)};return e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:i,className:`
          ${b.replyToMessage}
          ${n.receivedId===null?b.sentMessage:b.receivedMessage}
          ${n.reaction!==-1?b.hasReaction:""}
        `,children:e.jsx("p",{children:u.type==="image"?"Image":u.content})}),e.jsx(H,{index:c,prevMessage:null,nextMessage:s,message:n,replied:!0},c)]})}const be="_typingIndicator_1aw03_1",Ce="_dot_1aw03_13",C={typingIndicator:be,dot:Ce};function $e({style:c}){return e.jsxs($.div,{className:C.typingIndicator,style:{...c,width:c.width.to(s=>`${s}rem`),height:c.height.to(s=>`${s}rem`)},children:[e.jsx("span",{className:C.dot}),e.jsx("span",{className:C.dot}),e.jsx("span",{className:C.dot})]})}const Ne="_newMessageContainer_hryrq_1",Te="_newMessage_hryrq_1",F={newMessageContainer:Ne,newMessage:Te};function Be({style:c}){const s=()=>{n.current.scrollIntoView({behavior:"smooth"})},{chatBottom:n}=o.useContext(I);return e.jsx("div",{className:F.newMessageContainer,children:e.jsx($.div,{className:F.newMessage,onClick:s,style:c,children:"New Message"})})}function Se(){const{messages:c,chatBottom:s,typing:n,newMessage:r,setNewMessage:f}=o.useContext(I);o.useLayoutEffect(()=>{const i=new IntersectionObserver(a=>{a.forEach(h=>{h.isIntersecting&&f(!1)})},{threshold:.1}),t=s.current;return t&&i.observe(t),()=>{t&&i.unobserve(t)}},[]);const g=O(n,{from:{width:0,height:0,opacity:0},enter:{width:4,height:2.1,opacity:1,config:v.stiff},leave:{width:0,height:0,opacity:0,config:v.stiff},onRest:()=>{Z(s)&&s.current.scrollIntoView({behavior:"smooth"})}}),u=O(r,{from:{scale:0,opacity:0},enter:{scale:1,opacity:1,config:{tension:500,friction:15}},leave:{scale:0,opacity:0,config:{tension:500,friction:20}}});return e.jsxs("div",{className:V.chatContainer,children:[c.map((i,t,a)=>i.replyTo?e.jsx(Re,{index:t,nextMessage:a[t+1],message:i},`${i.sentId}m${i.receivedId}`):e.jsx(H,{index:t,prevMessage:a[t-1],nextMessage:a[t+1],message:i,replied:!1},`${i.sentId}m${i.receivedId}`)),g((i,t)=>t?e.jsx($e,{style:i}):null),u((i,t)=>t?e.jsx(Be,{style:i}):null),e.jsx("div",{ref:s,className:V.chatBottom,children:"Hehe"},"chatBottom")]})}export{Se as default};
