import{r as s,C as b,c as F,b as T,t as E,j as e,i as U}from"./index-BkPeKK39.js";const H="_inputSpaceContainer_1xk7w_1",z="_inputOptions_1xk7w_33",J="_sendButtonContainer_1xk7w_56",V="_imageBox_1xk7w_77",A="_inputImage_1xk7w_91",P="_closeImage_1xk7w_98",a={inputSpaceContainer:H,inputOptions:z,sendButtonContainer:J,imageBox:V,inputImage:A,closeImage:P};function D(){const{dataChannel:p}=s.useContext(b),{chatBottom:m,setMessages:h,sentId:o,selectedMessageId:c,replying:g,messages:l,setReplying:w,atBottomRef:f}=s.useContext(F),t=s.useRef(null),y=s.useRef(null),x=s.useRef(null),[j,I]=s.useState(!1),[u,C]=s.useState(""),[r,d]=s.useState(null),{showNotification:_}=T();s.useEffect(()=>{g&&t.current.focus()},[g]);const M=()=>{console.log("Typing message sent!"),p.current.send(JSON.stringify({type:"typing"}))},R=s.useRef(E(M,800)),v=()=>{R.current(),I(!0),t.current.style.height="auto",t.current.scrollHeight>t.current.clientHeight&&(t.current.style.height=t.current.scrollHeight+"px"),C(t.current.value),U(m)&&setTimeout(()=>{m.current.scrollIntoView({behavior:"smooth"})},100)},B=n=>{const i=n.target.files[0];if(i){if(i.size>2*1024*1024){_("Please upload images upto 2 MB!");return}d(i)}},N=()=>{if(u.trim().length===0)return;const n={type:"text",content:u.trimEnd()},i={sentId:o.current,type:"text",origin:"sent",status:"sending",reaction:-1,content:u.trimEnd(),deleted:0};g&&(n.reply={sentId:l[c].receivedId,receivedId:l[c].sentId},i.reply={sentId:l[c].sentId,receivedId:l[c].receivedId},w(!1)),p.current.send(JSON.stringify(n)),h(O=>[...O,i]),o.current=o.current+1,t.current.value="",f.current=!0,C("")},S=()=>{if(console.log("I am attempting to send an image!"),r===null)return;const n={sentId:o.current,type:"image",origin:"sent",status:"sent",reaction:-1,content:URL.createObjectURL(r),deleted:0};h(i=>[...i,n]),o.current=o.current+1,x.current.value="",f.current=!0,d(null)},k=()=>{I(!1),t.current.style.height="unset",t.current.scrollTop=t.current.scrollHeight},L=()=>{r===null?N():S()};return e.jsxs("div",{className:a.inputSpaceContainer,ref:y,children:[!j&&e.jsxs("div",{className:a.inputOptions,children:[e.jsx("label",{htmlFor:"fileInput",children:e.jsx("img",{src:"./photos.svg",alt:"Upload",width:20,height:20})}),e.jsx("input",{ref:x,id:"fileInput",type:"file",accept:"image/*",onChange:n=>B(n)}),e.jsx("img",{src:"./microphone.svg",width:20,height:20})]}),r?e.jsxs("div",{className:a.imageBox,children:[e.jsx("img",{src:URL.createObjectURL(r),className:a.inputImage}),e.jsx("svg",{className:a.closeImage,width:16,height:16,onClick:()=>{d(null)},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fill:"#A69CFF",d:"M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z"})})]}):e.jsx("textarea",{onChange:v,onFocus:v,onBlur:k,ref:t,name:"textMessage",placeholder:"Message",rows:1,spellCheck:!1}),e.jsx("div",{className:a.sendButtonContainer,children:e.jsx("button",{disabled:u.trim().length===0&&r===null,onClick:L,children:e.jsx("img",{src:"./send.svg",width:24,height:24,className:a.sendImage})})})]})}export{D as default};
