import{f as N,r,j as t,d as b,c as C,g as D,e as L}from"./index-CWDg0isr.js";const O="_chatContainer_iy9gp_1",X={chatContainer:O},A="_textMessage_53rrm_1",G="_receivedMessage_53rrm_16",U="_hasReaction_53rrm_16",V="_sentMessage_53rrm_20",Y="_topMessage_53rrm_37",q="_bottomMessage_53rrm_42",z="_sending_53rrm_62",H="_sent_53rrm_20",J="_repliedMessage_53rrm_79",K="_deletedMessage_53rrm_83",a={textMessage:A,receivedMessage:G,hasReaction:U,sentMessage:V,topMessage:Y,bottomMessage:q,sending:z,sent:H,repliedMessage:J,deletedMessage:K},Q="_reaction_1kw4y_1",W="_sentReaction_1kw4y_10",Z="_receivedReaction_1kw4y_15",T={reaction:Q,sentReaction:W,receivedReaction:Z},ee=["👍","❤️","😆","😮","😢","😡"];function te({reaction:o,origin:n}){const[g,i]=N(()=>({scale:1}));return r.useEffect(()=>{i.start({from:{scale:0},to:{scale:1},config:{tension:300,friction:15}})},[o]),o!==-1?t.jsx(b.span,{className:`${T.reaction} ${n==="sent"?T.sentReaction:T.receivedReaction}`,style:{...g},children:ee[o]}):t.jsx(t.Fragment,{})}function P({sentId:o,origin:n,content:g,reaction:i,prevMessage:h,nextMessage:l,status:M,receivedId:e,index:s,reply:d,deleted:c,highlight:j}){if(c===1)return t.jsx(t.Fragment,{});const[m,f]=N(()=>({scale:1,x:0})),_=r.useRef(null),u=r.useRef(!1),v=r.useRef(!0),{pointerPosition:p,setActionsShown:$,setReactionsShown:k,setSelectedMessageId:w,setReplying:F,longPressed:E}=r.useContext(C);r.useEffect(()=>{console.log("The value of highlight changed!"),f.start({from:{scale:0,opacity:0},to:[{scale:1.1,opacity:1},{scale:.95},{scale:1}],config:{tension:800,friction:15,duration:100}})},[f]),r.useEffect(()=>{if(v.current){v.current=!1;return}f.start({from:{scale:1},to:[{scale:1.3},{scale:1}],config:{tension:800,friction:20}})},[j]);const S=D({onPointerDown:({event:I})=>{u.current=!1,_.current=setTimeout(()=>{u.current||(p.current.x=I.clientX,p.current.y=I.clientY,E.current=!0,f.start({from:{scale:1},to:[{scale:.95},{scale:1.025},{scale:1}],config:{tension:600,friction:12,duration:100}}),$(!0),n!=="sent"&&k(!0),w(s))},500)},onPointerUp:()=>{setTimeout(()=>{E.current=!1},100),clearTimeout(_.current)},onPointerLeave:()=>{clearTimeout(_.current)},onDrag:({last:I,movement:[y]})=>{if(Math.abs(y)<5)return;u.current=Math.abs(y)>5,Math.abs(y)>60&&(w(s),F(!0));let B=n==="sent"?Math.min(0,y):Math.max(0,y);f.start({x:B}),u.current&&_.current&&(clearTimeout(_.current),_.current=null),I&&f.start({x:0,config:{tension:500,friction:20}})}},{eventOptions:{passive:!1}});return t.jsxs(b.div,{...c===0?S():{},style:{...m},id:s,"data-sent-id":o,"data-received-id":e,"data-index":s,className:`
        ${a.textMessage}
        ${M==="sending"?a.sending:a.sent}
        ${n==="sent"?a.sentMessage:a.receivedMessage}
        ${(l==null?void 0:l.origin)===n?a.topMessage:""}
        ${(h==null?void 0:h.origin)===n?a.bottomMessage:""}
        ${i!==-1&&c!==2?a.hasReaction:""}
        ${d?a.repliedMessage:""}
        ${c===2?a.deletedMessage:""}
      `,children:[t.jsx("p",{children:g}),c!==2&&t.jsx(te,{reaction:i,origin:n})]})}const se="_replyToMessage_9s3el_1",ne="_sentMessage_9s3el_19",oe="_receivedMessage_9s3el_24",R={replyToMessage:se,sentMessage:ne,receivedMessage:oe};function ce({sentId:o,origin:n,content:g,reaction:i,status:h,receivedId:l,index:M,reply:e,deleted:s,nextMessage:d}){const{messages:c,setMessages:j}=r.useContext(C),m=e.receivedId?c.findIndex(u=>u.receivedId===e.receivedId):c.findIndex(u=>u.sentId===e.sentId),f=c[m],_=()=>{document.getElementById(`${m}`).scrollIntoView({behavior:"instant"}),setTimeout(()=>{j(v=>v.map((p,$)=>$===m?{...p,highlight:!p.highlight}:p))},100)};return t.jsxs(t.Fragment,{children:[t.jsx("a",{onClick:_,className:`
                        ${R.replyToMessage}
                        ${n==="sent"?R.sentMessage:R.receivedMessage}
                        ${i?R.hasReaction:""}
                      `,children:t.jsx("p",{children:f.content})}),t.jsx(P,{index:M,sentId:o,receivedId:l,status:h,origin:n,content:g,reaction:i,reply:!0,deleted:s,nextMessage:d},M)]})}const re="_typingIndicator_hr8rf_1",ae="_dot_hr8rf_11",x={typingIndicator:re,dot:ae};function ie({style:o}){return t.jsxs(b.div,{className:x.typingIndicator,style:o,children:[t.jsx("span",{className:x.dot}),t.jsx("span",{className:x.dot}),t.jsx("span",{className:x.dot})]})}function de(){const{messages:o,chatBottom:n,newMessage:g,setNewMessage:i,typing:h}=r.useContext(C),l=r.useRef(null),M=L(h,{from:{scale:0,opacity:0},enter:{scale:1,opacity:1,config:{tension:200,friction:15}},leave:{scale:0,opacity:0,config:{tension:400,friction:20}}});return r.useEffect(()=>{const e=new IntersectionObserver(d=>{d.forEach(c=>{c.isIntersecting&&g&&i(!1)})},{threshold:.1}),s=l.current;return s&&e.observe(s),n.current=l.current,()=>{s&&e.unobserve(s)}},[g]),t.jsxs("div",{className:X.chatContainer,children:[o.map((e,s,d)=>e.reply?t.jsx(ce,{index:s,sentId:e.sentId,receivedId:e.receivedId,status:e.status,origin:e.origin,content:e.content,reaction:e.reaction,reply:e.reply,nextMessage:d[s+1],deleted:e.deleted},s):t.jsx(P,{index:s,sentId:e.sentId,receivedId:e.receivedId,status:e.status,origin:e.origin,content:e.content,reaction:e.reaction,prevMessage:d[s-1],nextMessage:d[s+1],deleted:e.deleted,highlight:e.highlight},s)),M((e,s)=>s?t.jsx(ie,{style:e}):null),t.jsx("div",{ref:l})]})}export{de as default};
