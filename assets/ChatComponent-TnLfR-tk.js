import{c as z,r as i,j as e,b,C as A,a as I,u as Z,f as v,g as ee,e as O,i as te}from"./index-D8dFMMA2.js";const se="_chatContainer_189rb_1",ne="_chatBottom_189rb_18",V={chatContainer:se,chatBottom:ne},oe="_textMessage_n2lc9_1",ce="_sentMessage_n2lc9_32",ie="_receivedMessage_n2lc9_37",ae="_sending_n2lc9_42",re="_sent_n2lc9_32",le="_deletedMessage_n2lc9_50",de="_topMessage_n2lc9_56",ue="_bottomMessage_n2lc9_61",ge="_repliedMessage_n2lc9_74",he="_hasImage_n2lc9_79",fe="_hasReaction_n2lc9_85",d={textMessage:oe,sentMessage:ce,receivedMessage:ie,sending:ae,sent:re,deletedMessage:le,topMessage:de,bottomMessage:ue,repliedMessage:ge,hasImage:he,hasReaction:fe},pe="_reaction_1t2b5_1",_e="_sentReaction_1t2b5_11",me="_receivedReaction_1t2b5_16",S={reaction:pe,sentReaction:_e,receivedReaction:me},xe=["ðŸ‘","â¤ï¸","ðŸ˜†","ðŸ˜®","ðŸ˜¢","ðŸ˜¡"];function Me({reaction:c,origin:t}){const[n,r]=z(()=>({scale:1}));return i.useEffect(()=>{r.start({from:{scale:0},to:{scale:1},config:{tension:300,friction:15}})},[c]),c!==-1?e.jsx(b.span,{className:`${S.reaction} ${t==="sent"?S.sentReaction:S.receivedReaction}`,style:{...n},children:xe[c]}):e.jsx(e.Fragment,{})}const je="_requestDiv_1axuz_1",ye="_decisionBox_1axuz_9",ve="_loading_1axuz_35",E={requestDiv:je,decisionBox:ye,loading:ve};function Ie({index:c,sentId:t,receivedId:n}){const{dataChannel:r,peerName:f}=i.useContext(A),{setMessages:u,receivingImage:g}=i.useContext(I),{showNotification:o}=Z(),[s,a]=i.useState(!1),h=()=>{g.current===null?(r.current.send(JSON.stringify({type:"imageAccept",sentId:n,receivedId:t})),a(!0)):o("Please wait for a while!")},N=()=>{r.current.send(JSON.stringify({type:"imageReject",sentId:n,receivedId:t})),u(w=>{const M=[...w];return M.splice(c,1),M})};return s?e.jsxs("div",{className:E.loading,children:[e.jsx("span",{children:"L"}),e.jsx("span",{children:"o"}),e.jsx("span",{children:"a"}),e.jsx("span",{children:"d"}),e.jsx("span",{children:"i"}),e.jsx("span",{children:"n"}),e.jsx("span",{children:"g"}),e.jsx("span",{children:"Â "}),e.jsx("span",{children:"i"}),e.jsx("span",{children:"m"}),e.jsx("span",{children:"a"}),e.jsx("span",{children:"g"}),e.jsx("span",{children:"e"})]}):e.jsxs("div",{className:E.requestDiv,children:[e.jsxs("div",{children:[f.current," wants to send you an image"]}),e.jsxs("div",{className:E.decisionBox,children:[e.jsx("button",{onClick:h,children:"Accept"}),e.jsx("button",{onClick:N,children:"Reject"})]})]})}function J({index:c,prevMessage:t,nextMessage:n,message:r,replied:f}){const{dataChannel:u}=i.useContext(A),{chatBottom:g,pointerPosition:o,setActionsShown:s,setReactionsShown:a,setSelectedMessageId:h,setReplying:N,longPressed:w,atBottomRef:M,setImageDialog:H}=i.useContext(I),{sentId:p,receivedId:_,type:T,status:P,content:B,reaction:q,deleted:j,highlight:U}=r,X=()=>{window.history.pushState(null,"","/image"),H({src:B,sent:_===null})},G={text:()=>e.jsxs("p",{children:[" ",B," "]}),image:()=>e.jsxs("p",{children:[" ",e.jsx("img",{src:B,onClick:X})," "]}),imageRequest:()=>e.jsx(Ie,{index:c,sentId:p,receivedId:_})};if(j===1)return e.jsx(e.Fragment,{});const[Y,y]=z(()=>({scale:1,x:0})),x=i.useRef(null),R=i.useRef(!1),k=i.useRef(!0),D=i.useRef(0),L=i.useRef(null);i.useEffect(()=>{M.current&&(g.current.scrollIntoView({behavior:"smooth"}),M.current=!1),y.start({from:{scale:0,opacity:0},to:[{scale:1,opacity:1}],reset:!1,config:v.stiff})},[]),i.useEffect(()=>{if(k.current){k.current=!1;return}(async()=>(L.current.scrollIntoView({behavior:"instant"}),await new Promise(l=>setTimeout(l,100)),y.start({from:{scale:1},to:[{scale:1.2},{scale:1}],config:v.stiff})))()},[U]);const K=()=>{if(p===null&&q!==1){let l={type:"reaction",id:_,reaction:1};u.current.send(JSON.stringify(l))}},Q=ee({onPointerDown:({event:l})=>{R.current=!1,x.current=setTimeout(()=>{R.current||(o.current.x=l.clientX,o.current.y=l.clientY,w.current=!0,y.start({from:{scale:1},to:[{scale:1.1},{scale:1}],config:v.stiff}),s(!0),p===null&&a(!0),h(c))},500)},onPointerUp:()=>{setTimeout(()=>{w.current=!1},100),clearTimeout(x.current);const l=Date.now();l-D.current<500?(K(),D.current=0):D.current=l},onPointerLeave:()=>{clearTimeout(x.current)},onDrag:({last:l,movement:[m]})=>{if(p===null){if(m<0)return}else if(m>0)return;if(Math.abs(m)<5)return;R.current=Math.abs(m)>5,Math.abs(m)>60&&(h(c),N(!0));let W=_===null?Math.min(0,m):Math.max(0,m);y.start({x:W}),R.current&&x.current&&(clearTimeout(x.current),x.current=null),l&&y.start({x:0,config:{tension:500,friction:20}})}},{eventOptions:{passive:!1}});return e.jsxs(b.div,{ref:L,...j!==0||T==="imageRequest"||P==="sending"?{}:Q(),style:{...Y},className:`
        ${d.textMessage}
        ${P==="sending"?d.sending:d.sent}
        ${_===null?d.sentMessage:d.receivedMessage}
        ${(n==null?void 0:n.sentId)===p||(n==null?void 0:n.receivedId)===_?d.topMessage:""}
        ${(t==null?void 0:t.sentId)===p||(t==null?void 0:t.receivedId)===_?d.bottomMessage:""}
        ${f?d.repliedMessage:""}
        ${j===2?d.deletedMessage:""}
        ${q!==-1&&j!==2?d.hasReaction:""}
        ${T==="image"?d.hasImage:""}
      `,children:[(G[T]||(()=>e.jsx("p",{children:e.jsx("span",{children:"Unknown type"})})))(),j!==2&&e.jsx(Me,{reaction:q,origin:p===null?"received":"sent"})]})}const we="_replyToMessage_1f615_1",Re="_sentMessage_1f615_20",Ce="_receivedMessage_1f615_25",C={replyToMessage:we,sentMessage:Re,receivedMessage:Ce};function $e({index:c,nextMessage:t,message:n}){const{messages:r,setMessages:f}=i.useContext(I),u=r.findIndex(s=>s.receivedId===n.replyTo.receivedId&&s.sentId===n.replyTo.sentId),g=r[u],o=()=>{setTimeout(()=>{f(s=>s.map((a,h)=>h===u?{...a,highlight:!a.highlight}:a))},100)};return e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:o,className:`
          ${C.replyToMessage}
          ${n.receivedId===null?C.sentMessage:C.receivedMessage}
          ${n.reaction!==-1?C.hasReaction:""}
        `,children:e.jsx("p",{children:g.type==="image"?"Image":g.content})}),e.jsx(J,{index:c,prevMessage:null,nextMessage:t,message:n,replied:!0},c)]})}const be="_typingIndicator_1onvb_1",Ne="_dot_1onvb_15",$={typingIndicator:be,dot:Ne};function Te({style:c}){return e.jsxs(b.div,{className:$.typingIndicator,style:{...c,width:c.width.to(t=>`${t}rem`),height:c.height.to(t=>`${t}rem`)},children:[e.jsx("span",{className:$.dot}),e.jsx("span",{className:$.dot}),e.jsx("span",{className:$.dot})]})}const Be="_newMessageContainer_16q0g_1",qe="_newMessage_16q0g_1",F={newMessageContainer:Be,newMessage:qe};function De({style:c}){const t=()=>{n.current.scrollIntoView({behavior:"smooth"})},{chatBottom:n}=i.useContext(I);return e.jsx("div",{className:F.newMessageContainer,children:e.jsx(b.div,{className:F.newMessage,onClick:t,style:c,children:"New Message"})})}function Ee(){const{messages:c,chatBottom:t,typing:n,newMessage:r,setNewMessage:f}=i.useContext(I);i.useLayoutEffect(()=>{const o=new IntersectionObserver(a=>{a.forEach(h=>{h.isIntersecting&&f(!1)})},{threshold:.1}),s=t.current;return s&&o.observe(s),()=>{s&&o.unobserve(s)}},[]);const u=O(n,{from:{width:0,height:0,opacity:0},enter:{width:4,height:2.1,opacity:1,config:v.stiff},leave:{width:0,height:0,opacity:0,config:v.stiff},onRest:()=>{te(t)&&t.current.scrollIntoView({behavior:"smooth"})}}),g=O(r,{from:{scale:0,opacity:0},enter:{scale:1,opacity:1,config:{tension:500,friction:15}},leave:{scale:0,opacity:0,config:{tension:500,friction:20}}});return e.jsxs("div",{className:V.chatContainer,children:[c.map((o,s,a)=>o.replyTo?e.jsx($e,{index:s,nextMessage:a[s+1],message:o},`${o.sentId}m${o.receivedId}`):e.jsx(J,{index:s,prevMessage:a[s-1],nextMessage:a[s+1],message:o,replied:!1},`${o.sentId}m${o.receivedId}`)),u((o,s)=>s?e.jsx(Te,{style:o}):null),g((o,s)=>s?e.jsx(De,{style:o}):null),e.jsx("div",{ref:t,className:V.chatBottom,children:"Hehe"},"chatBottom")]})}export{Ee as default};
