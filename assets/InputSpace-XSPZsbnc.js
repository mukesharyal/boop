import{r as c,C as T,c as b,b as E,t as U,j as e,k as H}from"./index-Cr1LMo6m.js";const J="_inputSpaceContainer_1xk7w_1",q="_inputOptions_1xk7w_33",z="_sendButtonContainer_1xk7w_56",A="_imageBox_1xk7w_77",P="_inputImage_1xk7w_91",D="_closeImage_1xk7w_98",l={inputSpaceContainer:J,inputOptions:q,sendButtonContainer:z,imageBox:A,inputImage:P,closeImage:D};function Q(){const{dataChannel:p,imageChannel:G}=c.useContext(T),{setMessages:f,sentId:r,selectedMessageId:i,replying:d,messages:a,setReplying:x,atBottomRef:v,images:h}=c.useContext(b),n=c.useRef(null),_=c.useRef(null),I=c.useRef(null),[j,y]=c.useState(!1),[g,C]=c.useState(""),[o,m]=c.useState(null),{showNotification:M}=E();c.useLayoutEffect(()=>{d&&n.current.focus()},[d]);const R=()=>{p.current.send(JSON.stringify({type:"typing"}))},k=c.useRef(U(R,800)),w=()=>{k.current(),y(!0),n.current.style.height="auto",n.current.scrollHeight>n.current.clientHeight&&(n.current.style.height=n.current.scrollHeight+"px"),C(n.current.value)},B=async s=>{const t=s.target.files[0];if(!t)return;const u=await H(t);if(u.length>64){M("Please upload images upto 2 MB!");return}h.current.push({sentId:r.current,receivedId:null,fileType:t.type,chunks:u}),m(URL.createObjectURL(t))},N=()=>{if(g.trim().length===0)return;const s={type:"text",content:g.trimEnd(),sentId:r.current,receivedId:null},t={sentId:r.current,receivedId:null,type:"text",status:"sending",reaction:-1,content:g.trimEnd(),deleted:0};d&&(s.replyTo={sentId:a[i].sentId,receivedId:a[i].receivedId},t.replyTo={sentId:a[i].sentId,receivedId:a[i].receivedId},x(!1)),p.current.send(JSON.stringify(s)),f(u=>[...u,t]),r.current=r.current+1,n.current.value="",v.current=!0,C("")},S=()=>{if(o===null)return;const s={type:"imageRequest",sentId:r.current,receivedId:null},t={sentId:r.current,receivedId:null,type:"image",status:"sending",reaction:-1,content:o,deleted:0};d&&(s.reply={sentId:a[i].receivedId,receivedId:a[i].sentId},t.reply={sentId:a[i].sentId,receivedId:a[i].receivedId},x(!1)),p.current.send(JSON.stringify(s)),f(u=>[...u,t]),r.current=r.current+1,I.current.value="",v.current=!0,m(null)},L=()=>{y(!1),n.current.style.height="unset",n.current.scrollTop=n.current.scrollHeight},O=()=>{I.current.value="";const s=h.current.findIndex(t=>t.sentId===r.current&&t.receivedId===null);h.current.splice(s,1),m(null)},F=()=>{o===null?N():S()};return e.jsxs("div",{className:l.inputSpaceContainer,ref:_,children:[!j&&e.jsxs("div",{className:l.inputOptions,children:[e.jsx("label",{htmlFor:"fileInput",children:e.jsx("img",{src:"./photos.svg",alt:"Upload",width:20,height:20})}),e.jsx("input",{ref:I,id:"fileInput",type:"file",accept:"image/*",onChange:s=>B(s)}),e.jsx("img",{src:"./microphone.svg",width:20,height:20})]}),o?e.jsxs("div",{className:l.imageBox,children:[e.jsx("img",{src:o,className:l.inputImage}),e.jsx("svg",{className:l.closeImage,width:16,height:16,onClick:O,viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fill:"#A69CFF",d:"M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z"})})]}):e.jsx("textarea",{onChange:w,onFocus:w,onBlur:L,ref:n,name:"textMessage",placeholder:"Message",rows:1,spellCheck:!1}),e.jsx("div",{className:l.sendButtonContainer,children:e.jsx("button",{disabled:g.trim().length===0&&o===null,onClick:F,children:e.jsx("img",{src:"./send.svg",width:24,height:24,className:l.sendImage})})})]})}export{Q as default};
