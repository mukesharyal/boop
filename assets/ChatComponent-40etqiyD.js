import{f as P,r as o,j as s,d as C,C as L,c as b,g as X,e as A,i as G}from"./index-CUUhV7XG.js";const H="_chatContainer_iy9gp_1",J={chatContainer:H},U="_textMessage_53rrm_1",Y="_receivedMessage_53rrm_16",q="_hasReaction_53rrm_16",K="_sentMessage_53rrm_20",Q="_topMessage_53rrm_37",W="_bottomMessage_53rrm_42",Z="_sending_53rrm_62",ee="_sent_53rrm_20",te="_repliedMessage_53rrm_79",se="_deletedMessage_53rrm_83",a={textMessage:U,receivedMessage:Y,hasReaction:q,sentMessage:K,topMessage:Q,bottomMessage:W,sending:Z,sent:ee,repliedMessage:te,deletedMessage:se},ne="_reaction_1kw4y_1",re="_sentReaction_1kw4y_10",oe="_receivedReaction_1kw4y_15",T={reaction:ne,sentReaction:re,receivedReaction:oe},ce=["👍","❤️","😆","😮","😢","😡"];function ie({reaction:r,origin:n}){const[f,d]=P(()=>({scale:1}));return o.useEffect(()=>{d.start({from:{scale:0},to:{scale:1},config:{tension:300,friction:15}})},[r]),r!==-1?s.jsx(C.span,{className:`${T.reaction} ${n==="sent"?T.sentReaction:T.receivedReaction}`,style:{...f},children:ce[r]}):s.jsx(s.Fragment,{})}function S({sentId:r,origin:n,content:f,reaction:d,prevMessage:p,nextMessage:l,status:y,receivedId:e,index:t,reply:u,deleted:g,highlight:v}){if(g===1)return s.jsx(s.Fragment,{});const[$,i]=P(()=>({scale:1,x:0})),{dataChannel:j}=o.useContext(L),_=o.useRef(null),h=o.useRef(!1),I=o.useRef(!0),M=o.useRef(0),{pointerPosition:x,setActionsShown:k,setReactionsShown:z,setSelectedMessageId:E,setReplying:F,longPressed:N,messages:D}=o.useContext(b);o.useEffect(()=>{console.log("The value of highlight changed!"),i.start({from:{scale:0,opacity:0},to:[{scale:1,opacity:1}],config:{duration:100}})},[i]),o.useEffect(()=>{if(I.current){I.current=!1;return}i.start({from:{scale:1},to:[{scale:1.3},{scale:1}],config:{tension:400,friction:20}})},[v]);const O=()=>{const c=D[t];if("receivedId"in c&&c.reaction!==1){let m={type:"reaction",id:c.receivedId,reaction:1};j.current.send(JSON.stringify(m))}},V=X({onPointerDown:({event:c})=>{h.current=!1,_.current=setTimeout(()=>{h.current||(x.current.x=c.clientX,x.current.y=c.clientY,N.current=!0,i.start({from:{scale:1},to:[{scale:.95},{scale:1.025},{scale:1}],config:{tension:600,friction:12,duration:100}}),k(!0),n!=="sent"&&z(!0),E(t))},500)},onPointerUp:()=>{setTimeout(()=>{N.current=!1},100),clearTimeout(_.current);const c=Date.now();c-M.current<500?(O(),M.current=0):M.current=c},onPointerLeave:()=>{clearTimeout(_.current)},onDrag:({last:c,movement:[m]})=>{if(Math.abs(m)<5)return;h.current=Math.abs(m)>5,Math.abs(m)>60&&(E(t),F(!0));let B=n==="sent"?Math.min(0,m):Math.max(0,m);i.start({x:B}),h.current&&_.current&&(clearTimeout(_.current),_.current=null),c&&i.start({x:0,config:{tension:500,friction:20}})}},{eventOptions:{passive:!1}});return s.jsxs(C.div,{...g===0?V():{},style:{...$},id:t,"data-sent-id":r,"data-received-id":e,"data-index":t,className:`
        ${a.textMessage}
        ${y==="sending"?a.sending:a.sent}
        ${n==="sent"?a.sentMessage:a.receivedMessage}
        ${(l==null?void 0:l.origin)===n?a.topMessage:""}
        ${(p==null?void 0:p.origin)===n?a.bottomMessage:""}
        ${d!==-1&&g!==2?a.hasReaction:""}
        ${u?a.repliedMessage:""}
        ${g===2?a.deletedMessage:""}
      `,children:[s.jsx("p",{children:f}),g!==2&&s.jsx(ie,{reaction:d,origin:n})]})}const ae="_replyToMessage_1vwrx_1",de="_sentMessage_1vwrx_19",le="_receivedMessage_1vwrx_24",R={replyToMessage:ae,sentMessage:de,receivedMessage:le};function ue({sentId:r,origin:n,content:f,reaction:d,status:p,receivedId:l,index:y,reply:e,deleted:t,nextMessage:u,highlight:g}){const{messages:v,setMessages:$}=o.useContext(b),i=e.receivedId?v.findIndex(h=>h.receivedId===e.receivedId):v.findIndex(h=>h.sentId===e.sentId),j=v[i],_=()=>{document.getElementById(`${i}`).scrollIntoView({behavior:"instant"}),setTimeout(()=>{$(I=>I.map((M,x)=>x===i?{...M,highlight:!M.highlight}:M))},100)};return s.jsxs(s.Fragment,{children:[s.jsx("a",{onClick:_,className:`
                        ${R.replyToMessage}
                        ${n==="sent"?R.sentMessage:R.receivedMessage}
                        ${d?R.hasReaction:""}
                      `,children:s.jsx("p",{children:j.content})}),s.jsx(S,{index:y,sentId:r,receivedId:l,status:p,origin:n,content:f,reaction:d,reply:!0,deleted:t,nextMessage:u,highlight:g},y)]})}const ge="_typingIndicator_1yzuz_1",he="_dot_1yzuz_12",w={typingIndicator:ge,dot:he};function fe({style:r}){return s.jsxs(C.div,{className:w.typingIndicator,style:{...r,width:r.width.to(n=>`${n}rem`),height:r.height.to(n=>`${n}rem`)},children:[s.jsx("span",{className:w.dot}),s.jsx("span",{className:w.dot}),s.jsx("span",{className:w.dot})]})}function pe(){const{messages:r,chatBottom:n,newMessage:f,setNewMessage:d,typing:p}=o.useContext(b),l=o.useRef(null),y=A(p,{from:{width:0,height:0,opacity:0},enter:{width:4,height:2.1,opacity:1,config:{tension:400,friction:20}},leave:{width:0,height:0,opacity:0,config:{duration:200}}});return o.useEffect(()=>{const e=new IntersectionObserver(u=>{u.forEach(g=>{g.isIntersecting&&f&&d(!1)})},{threshold:.1}),t=l.current;return t&&e.observe(t),n.current=l.current,()=>{t&&e.unobserve(t)}},[f]),s.jsxs("div",{className:J.chatContainer,children:[r.map((e,t,u)=>e.reply?s.jsx(ue,{index:t,sentId:e.sentId,receivedId:e.receivedId,status:e.status,origin:e.origin,content:e.content,reaction:e.reaction,reply:e.reply,nextMessage:u[t+1],deleted:e.deleted,highlight:e.highlight},t):s.jsx(S,{index:t,sentId:e.sentId,receivedId:e.receivedId,status:e.status,origin:e.origin,content:e.content,reaction:e.reaction,prevMessage:u[t-1],nextMessage:u[t+1],deleted:e.deleted,highlight:e.highlight},t)),y((e,t)=>t?(G(n)&&n.current.scrollIntoView({behavior:"instant"}),s.jsx(fe,{style:e})):null),s.jsx("div",{ref:l})]})}export{pe as default};
