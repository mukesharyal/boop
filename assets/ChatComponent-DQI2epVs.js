import{f as j,r as u,j as s,d as b,c as x,g as k}from"./index-Dix0VLSN.js";const F="_chatContainer_iy9gp_1",D={chatContainer:F},L="_textMessage_1w1lt_1",O="_receivedMessage_1w1lt_15",X="_hasReaction_1w1lt_15",A="_sentMessage_1w1lt_19",B="_topMessage_1w1lt_36",G="_bottomMessage_1w1lt_41",U="_sending_1w1lt_61",Y="_sent_1w1lt_19",q="_repliedMessage_1w1lt_78",z="_deletedMessage_1w1lt_82",r={textMessage:L,receivedMessage:O,hasReaction:X,sentMessage:A,topMessage:B,bottomMessage:G,sending:U,sent:Y,repliedMessage:q,deletedMessage:z},H="_reaction_1kw4y_1",J="_sentReaction_1kw4y_10",K="_receivedReaction_1kw4y_15",w={reaction:H,sentReaction:J,receivedReaction:K},Q=["👍","❤️","😆","😮","😢","😡"];function V({reaction:a,origin:n}){const[f,i]=j(()=>({scale:1}));return u.useEffect(()=>{i.start({from:{scale:0},to:{scale:1},config:{tension:300,friction:15}})},[a]),a!==-1?s.jsx(b.span,{className:`${w.reaction} ${n==="sent"?w.sentReaction:w.receivedReaction}`,style:{...f},children:Q[a]}):s.jsx(s.Fragment,{})}function C({sentId:a,origin:n,content:f,reaction:i,prevMessage:l,nextMessage:e,status:t,receivedId:c,index:_,reply:R,deleted:d}){if(d===1)return s.jsx(s.Fragment,{});const[p,g]=j(()=>({scale:1,x:0})),o=u.useRef(null),h=u.useRef(!1),{pointerPosition:I,setActionsShown:T,setReactionsShown:E,setSelectedMessageId:$,setReplying:N,longPressed:m}=u.useContext(x);u.useEffect(()=>{g.start({from:{scale:0,opacity:0},to:[{scale:1.1,opacity:1},{scale:.95},{scale:1}],config:{tension:800,friction:15,duration:100}})},[g]);const P=k({onPointerDown:({event:v})=>{h.current=!1,o.current=setTimeout(()=>{h.current||(I.current.x=v.clientX,I.current.y=v.clientY,m.current=!0,g.start({from:{scale:1},to:[{scale:.95},{scale:1.025},{scale:1}],config:{tension:600,friction:12,duration:100}}),T(!0),n!=="sent"&&E(!0),$(_))},500)},onPointerUp:()=>{setTimeout(()=>{m.current=!1},100),clearTimeout(o.current)},onPointerLeave:()=>{clearTimeout(o.current)},onDrag:({last:v,movement:[M]})=>{if(Math.abs(M)<5)return;h.current=Math.abs(M)>5,Math.abs(M)>60&&($(_),N(!0));let S=n==="sent"?Math.min(0,M):Math.max(0,M);g.start({x:S}),h.current&&o.current&&(clearTimeout(o.current),o.current=null),v&&g.start({x:0,config:{tension:500,friction:20}})}},{eventOptions:{passive:!1}});return s.jsxs(b.div,{...d===0?P():{},style:{...p},id:_,"data-sent-id":a,"data-received-id":c,"data-index":_,className:`
        ${r.textMessage}
        ${t==="sending"?r.sending:r.sent}
        ${n==="sent"?r.sentMessage:r.receivedMessage}
        ${(e==null?void 0:e.origin)===n?r.topMessage:""}
        ${(l==null?void 0:l.origin)===n?r.bottomMessage:""}
        ${i!==-1&&d!==2?r.hasReaction:""}
        ${R?r.repliedMessage:""}
        ${d===2?r.deletedMessage:""}
      `,children:[s.jsx("p",{children:f}),d!==2&&s.jsx(V,{reaction:i,origin:n})]})}const W="_replyToMessage_9s3el_1",Z="_sentMessage_9s3el_19",ee="_receivedMessage_9s3el_24",y={replyToMessage:W,sentMessage:Z,receivedMessage:ee};function te({sentId:a,origin:n,content:f,reaction:i,status:l,receivedId:e,index:t,reply:c,deleted:_,nextMessage:R}){const{messages:d}=u.useContext(x),p=c.receivedId?d.findIndex(o=>o.receivedId===c.receivedId):d.findIndex(o=>o.sentId===c.sentId),g=d[p];return console.log(g),s.jsxs(s.Fragment,{children:[s.jsx("a",{href:`#${p}`,className:`
                        ${y.replyToMessage}
                        ${n==="sent"?y.sentMessage:y.receivedMessage}
                        ${i?y.hasReaction:""}
                      `,children:s.jsx("p",{children:g.content})}),s.jsx(C,{index:t,sentId:a,receivedId:e,status:l,origin:n,content:f,reaction:i,reply:!0,deleted:_,nextMessage:R},t)]})}function ne(){const{messages:a,chatBottom:n,newMessage:f,setNewMessage:i}=u.useContext(x),l=u.useRef(null);return u.useEffect(()=>{const e=new IntersectionObserver(c=>{c.forEach(_=>{_.isIntersecting&&f&&i(!1)})},{threshold:.1}),t=l.current;return t&&e.observe(t),n.current=l.current,()=>{t&&e.unobserve(t)}},[f]),s.jsxs("div",{className:D.chatContainer,children:[a.map((e,t,c)=>e.reply?s.jsx(te,{index:t,sentId:e.sentId,receivedId:e.receivedId,status:e.status,origin:e.origin,content:e.content,reaction:e.reaction,reply:e.reply,nextMessage:c[t+1],deleted:e.deleted},t):s.jsx(C,{index:t,sentId:e.sentId,receivedId:e.receivedId,status:e.status,origin:e.origin,content:e.content,reaction:e.reaction,prevMessage:c[t-1],nextMessage:c[t+1],deleted:e.deleted},t)),s.jsx("div",{ref:l})]})}export{ne as default};
