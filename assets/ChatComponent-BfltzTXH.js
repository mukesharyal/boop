import{f as A,r as a,j as e,d as $,C as J,c as I,b as Q,g as y,h as W,e as O,i as Z}from"./index-b_Mgl_Vy.js";const ee="_chatContainer_4p2h9_1",se="_chatBottom_4p2h9_16",V={chatContainer:ee,chatBottom:se},te="_textMessage_7a4v1_1",ne="_sentMessage_7a4v1_35",oe="_topMessage_7a4v1_40",ce="_bottomMessage_7a4v1_45",ae="_receivedMessage_7a4v1_50",ie="_sending_7a4v1_65",re="_sent_7a4v1_35",le="_repliedMessage_7a4v1_82",de="_deletedMessage_7a4v1_86",ge="_hasReaction_7a4v1_92",he="_hasImage_7a4v1_96",l={textMessage:te,sentMessage:ne,topMessage:oe,bottomMessage:ce,receivedMessage:ae,sending:ie,sent:re,repliedMessage:le,deletedMessage:de,hasReaction:ge,hasImage:he},ue="_reaction_1hg6b_1",fe="_sentReaction_1hg6b_11",pe="_receivedReaction_1hg6b_16",S={reaction:ue,sentReaction:fe,receivedReaction:pe},_e=["👍","❤️","😆","😮","😢","😡"];function me({reaction:c,origin:s}){const[n,r]=A(()=>({scale:1}));return a.useEffect(()=>{r.start({from:{scale:0},to:{scale:1},config:{tension:300,friction:15}})},[c]),c!==-1?e.jsx($.span,{className:`${S.reaction} ${s==="sent"?S.sentReaction:S.receivedReaction}`,style:{...n},children:_e[c]}):e.jsx(e.Fragment,{})}const xe="_requestDiv_1le1e_2",ve="_decisionBox_1le1e_10",Me="_loading_1le1e_36",D={requestDiv:xe,decisionBox:ve,loading:Me};function je({index:c,sentId:s,receivedId:n}){const{dataChannel:r,peerName:f}=a.useContext(J),{setMessages:g,receivingImage:h}=a.useContext(I),{showNotification:o}=Q(),[t,i]=a.useState(!1),u=()=>{h.current===null?(r.current.send(JSON.stringify({type:"imageAccept",sentId:n,receivedId:s})),i(!0)):o("Please wait for a while!")},N=()=>{r.current.send(JSON.stringify({type:"imageReject",sentId:n,receivedId:s})),g(w=>{const m=[...w];return m.splice(c,1),m})};return t?e.jsxs("div",{className:D.loading,children:[e.jsx("span",{children:"L"}),e.jsx("span",{children:"o"}),e.jsx("span",{children:"a"}),e.jsx("span",{children:"d"}),e.jsx("span",{children:"i"}),e.jsx("span",{children:"n"}),e.jsx("span",{children:"g"}),e.jsx("span",{children:" "}),e.jsx("span",{children:"i"}),e.jsx("span",{children:"m"}),e.jsx("span",{children:"a"}),e.jsx("span",{children:"g"}),e.jsx("span",{children:"e"})]}):e.jsxs("div",{className:D.requestDiv,children:[e.jsxs("div",{children:[f.current," wants to send you an image"]}),e.jsxs("div",{className:D.decisionBox,children:[e.jsx("button",{onClick:u,children:"Accept"}),e.jsx("button",{onClick:N,children:"Reject"})]})]})}function H({index:c,prevMessage:s,nextMessage:n,message:r,replied:f}){const{dataChannel:g}=a.useContext(J),{chatBottom:h,pointerPosition:o,setActionsShown:t,setReactionsShown:i,setSelectedMessageId:u,setReplying:N,longPressed:w,atBottomRef:m}=a.useContext(I),{sentId:p,receivedId:x,type:T,status:E,content:P,reaction:B,deleted:v,highlight:U}=r,X={text:()=>e.jsxs("p",{children:[" ",P," "]}),image:()=>e.jsxs("p",{children:[" ",e.jsx("img",{src:P})," "]}),imageRequest:()=>e.jsx(je,{index:c,sentId:p,receivedId:x})};if(v===1)return e.jsx(e.Fragment,{});const[G,M]=A(()=>({scale:1,x:0})),_=a.useRef(null),R=a.useRef(!1),k=a.useRef(!0),q=a.useRef(0),L=a.useRef(null);a.useEffect(()=>{m.current&&(h.current.scrollIntoView({behavior:"smooth"}),m.current=!1),M.start({from:{scale:0,opacity:0},to:[{scale:1,opacity:1}],reset:!1,config:y.stiff})},[]),a.useEffect(()=>{if(k.current){k.current=!1;return}L.current.scrollIntoView({behavior:"smooth"}),M.start({from:{scale:1},to:[{scale:1.3},{scale:1}],config:y.stiff})},[U]);const Y=()=>{if(p===null&&B!==1){let d={type:"reaction",id:x,reaction:1};g.current.send(JSON.stringify(d))}},z=W({onPointerDown:({event:d})=>{R.current=!1,_.current=setTimeout(()=>{R.current||(o.current.x=d.clientX,o.current.y=d.clientY,w.current=!0,M.start({from:{scale:1},to:[{scale:1.1},{scale:1}],config:y.stiff}),t(!0),p===null&&i(!0),u(c))},500)},onPointerUp:()=>{setTimeout(()=>{w.current=!1},100),clearTimeout(_.current);const d=Date.now();d-q.current<500?(Y(),q.current=0):q.current=d},onPointerLeave:()=>{clearTimeout(_.current)},onDrag:({last:d,movement:[j]})=>{if(Math.abs(j)<5)return;R.current=Math.abs(j)>5,Math.abs(j)>60&&(u(c),N(!0));let K=origin==="sent"?Math.min(0,j):Math.max(0,j);M.start({x:K}),R.current&&_.current&&(clearTimeout(_.current),_.current=null),d&&M.start({x:0,config:{tension:500,friction:20}})}},{eventOptions:{passive:!1}});return e.jsxs($.div,{ref:L,...v!==0||T==="imageRequest"||E==="sending"?{}:z(),style:{...G},className:`
        ${l.textMessage}
        ${E==="sending"?l.sending:l.sent}
        ${x===null?l.sentMessage:l.receivedMessage}
        ${(n==null?void 0:n.sentId)===p||(n==null?void 0:n.receivedId)===x?l.topMessage:""}
        ${(s==null?void 0:s.sentId)===p||(s==null?void 0:s.receivedId)===x?l.bottomMessage:""}
        ${f?l.repliedMessage:""}
        ${v===2?l.deletedMessage:""}
        ${B!==-1&&v!==2?l.hasReaction:""}
        ${T==="image"?l.hasImage:""}
      `,children:[(X[T]||(()=>e.jsx("p",{children:e.jsx("span",{children:"Unknown type"})})))(),v!==2&&e.jsx(me,{reaction:B,origin:p===null?"received":"sent"})]})}const ye="_replyToMessage_1hbbr_1",Ie="_sentMessage_1hbbr_20",we="_receivedMessage_1hbbr_25",b={replyToMessage:ye,sentMessage:Ie,receivedMessage:we};function Re({index:c,nextMessage:s,message:n}){const{messages:r,setMessages:f}=a.useContext(I),g=r.findIndex(t=>t.receivedId===n.replyTo.receivedId&&t.sentId===n.replyTo.sentId),h=r[g],o=()=>{setTimeout(()=>{f(t=>t.map((i,u)=>u===g?{...i,highlight:!i.highlight}:i))},100)};return e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:o,className:`
          ${b.replyToMessage}
          ${n.receivedId===null?b.sentMessage:b.receivedMessage}
          ${n.reaction!==-1?b.hasReaction:""}
        `,children:e.jsx("p",{children:h.type==="image"?"Image":h.content})}),e.jsx(H,{index:c,prevMessage:null,nextMessage:s,message:n,replied:!0},c)]})}const be="_typingIndicator_1aw03_1",Ce="_dot_1aw03_13",C={typingIndicator:be,dot:Ce};function $e({style:c}){return e.jsxs($.div,{className:C.typingIndicator,style:{...c,width:c.width.to(s=>`${s}rem`),height:c.height.to(s=>`${s}rem`)},children:[e.jsx("span",{className:C.dot}),e.jsx("span",{className:C.dot}),e.jsx("span",{className:C.dot})]})}const Ne="_newMessageContainer_hryrq_1",Te="_newMessage_hryrq_1",F={newMessageContainer:Ne,newMessage:Te};function Be({style:c}){const s=()=>{n.current.scrollIntoView({behavior:"smooth"})},{chatBottom:n}=a.useContext(I);return e.jsx("div",{className:F.newMessageContainer,children:e.jsx($.div,{className:F.newMessage,onClick:s,style:c,children:"New Message"})})}function Se(){const{messages:c,chatBottom:s,typing:n,newMessage:r,setNewMessage:f}=a.useContext(I);a.useLayoutEffect(()=>{const o=new IntersectionObserver(i=>{i.forEach(u=>{u.isIntersecting&&f(!1)})},{threshold:.1}),t=s.current;return t&&o.observe(t),()=>{t&&o.unobserve(t)}},[]);const g=O(n,{from:{width:0,height:0,opacity:0},enter:{width:4,height:2.1,opacity:1,config:y.stiff},leave:{width:0,height:0,opacity:0,config:y.stiff},onRest:()=>{Z(s)&&s.current.scrollIntoView({behavior:"smooth"})}}),h=O(r,{from:{scale:0,opacity:0},enter:{scale:1,opacity:1,config:{tension:500,friction:15}},leave:{scale:0,opacity:0,config:{tension:500,friction:20}}});return e.jsxs("div",{className:V.chatContainer,children:[c.map((o,t,i)=>o.replyTo?e.jsx(Re,{index:t,nextMessage:i[t+1],message:o},`${o.sentId}m${o.receivedId}`):e.jsx(H,{index:t,prevMessage:i[t-1],nextMessage:i[t+1],message:o,replied:!1},`${o.sentId}m${o.receivedId}`)),g((o,t)=>t?e.jsx($e,{style:o}):null),h((o,t)=>t?e.jsx(Be,{style:o}):null),e.jsx("div",{ref:s,className:V.chatBottom,children:"Hehe"},"chatBottom")]})}export{Se as default};
