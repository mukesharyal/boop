import{f as A,r as i,j as e,d as $,C as J,c as I,b as Q,g as v,h as W,e as O,i as Z}from"./index-Cr1LMo6m.js";const ee="_chatContainer_4p2h9_1",te="_chatBottom_4p2h9_16",V={chatContainer:ee,chatBottom:te},se="_textMessage_x5k7l_1",ne="_sentMessage_x5k7l_34",oe="_topMessage_x5k7l_39",ce="_bottomMessage_x5k7l_44",ie="_receivedMessage_x5k7l_49",ae="_sending_x5k7l_64",re="_sent_x5k7l_34",le="_repliedMessage_x5k7l_81",de="_deletedMessage_x5k7l_85",ge="_hasReaction_x5k7l_91",ue="_hasImage_x5k7l_95",l={textMessage:se,sentMessage:ne,topMessage:oe,bottomMessage:ce,receivedMessage:ie,sending:ae,sent:re,repliedMessage:le,deletedMessage:de,hasReaction:ge,hasImage:ue},he="_reaction_1hg6b_1",fe="_sentReaction_1hg6b_11",pe="_receivedReaction_1hg6b_16",S={reaction:he,sentReaction:fe,receivedReaction:pe},_e=["👍","❤️","😆","😮","😢","😡"];function me({reaction:c,origin:t}){const[n,r]=A(()=>({scale:1}));return i.useEffect(()=>{r.start({from:{scale:0},to:{scale:1},config:{tension:300,friction:15}})},[c]),c!==-1?e.jsx($.span,{className:`${S.reaction} ${t==="sent"?S.sentReaction:S.receivedReaction}`,style:{...n},children:_e[c]}):e.jsx(e.Fragment,{})}const xe="_requestDiv_1le1e_2",Me="_decisionBox_1le1e_10",je="_loading_1le1e_36",q={requestDiv:xe,decisionBox:Me,loading:je};function ye({index:c,sentId:t,receivedId:n}){const{dataChannel:r,peerName:f}=i.useContext(J),{setMessages:g,receivingImage:u}=i.useContext(I),{showNotification:o}=Q(),[s,a]=i.useState(!1),h=()=>{u.current===null?(r.current.send(JSON.stringify({type:"imageAccept",sentId:n,receivedId:t})),a(!0)):o("Please wait for a while!")},N=()=>{r.current.send(JSON.stringify({type:"imageReject",sentId:n,receivedId:t})),g(w=>{const p=[...w];return p.splice(c,1),p})};return s?e.jsxs("div",{className:q.loading,children:[e.jsx("span",{children:"L"}),e.jsx("span",{children:"o"}),e.jsx("span",{children:"a"}),e.jsx("span",{children:"d"}),e.jsx("span",{children:"i"}),e.jsx("span",{children:"n"}),e.jsx("span",{children:"g"}),e.jsx("span",{children:" "}),e.jsx("span",{children:"i"}),e.jsx("span",{children:"m"}),e.jsx("span",{children:"a"}),e.jsx("span",{children:"g"}),e.jsx("span",{children:"e"})]}):e.jsxs("div",{className:q.requestDiv,children:[e.jsxs("div",{children:[f.current," wants to send you an image"]}),e.jsxs("div",{className:q.decisionBox,children:[e.jsx("button",{onClick:h,children:"Accept"}),e.jsx("button",{onClick:N,children:"Reject"})]})]})}function H({index:c,prevMessage:t,nextMessage:n,message:r,replied:f}){const{dataChannel:g}=i.useContext(J),{chatBottom:u,pointerPosition:o,setActionsShown:s,setReactionsShown:a,setSelectedMessageId:h,setReplying:N,longPressed:w,atBottomRef:p}=i.useContext(I),{sentId:_,receivedId:x,type:T,status:D,content:E,reaction:k,deleted:M,highlight:U}=r,X={text:()=>e.jsxs("p",{children:[" ",E," "]}),image:()=>e.jsxs("p",{children:[" ",e.jsx("img",{src:E})," "]}),imageRequest:()=>e.jsx(ye,{index:c,sentId:_,receivedId:x})};if(M===1)return e.jsx(e.Fragment,{});const[G,j]=A(()=>({scale:1,x:0})),m=i.useRef(null),R=i.useRef(!1),P=i.useRef(!0),B=i.useRef(0),L=i.useRef(null);i.useEffect(()=>{j.start({from:{scale:0,opacity:0},to:[{scale:1,opacity:1}],reset:!1,config:v.stiff,onStart:p.current?()=>{u.current.scrollIntoView({behavior:"smooth"}),p.current=!1}:null})},[]),i.useEffect(()=>{if(P.current){P.current=!1;return}j.start({from:{scale:1},to:[{scale:1.3},{scale:1}],config:v.stiff,onStart:p.current?()=>{L.current.scrollIntoView({behavior:"instant"})}:null})},[U]);const Y=()=>{if(_===null&&k!==1){let d={type:"reaction",id:x,reaction:1};g.current.send(JSON.stringify(d))}},z=W({onPointerDown:({event:d})=>{R.current=!1,m.current=setTimeout(()=>{R.current||(o.current.x=d.clientX,o.current.y=d.clientY,w.current=!0,j.start({from:{scale:1},to:[{scale:1.1},{scale:1}],config:v.stiff}),s(!0),_===null&&a(!0),h(c))},500)},onPointerUp:()=>{setTimeout(()=>{w.current=!1},100),clearTimeout(m.current);const d=Date.now();d-B.current<500?(Y(),B.current=0):B.current=d},onPointerLeave:()=>{clearTimeout(m.current)},onDrag:({last:d,movement:[y]})=>{if(Math.abs(y)<5)return;R.current=Math.abs(y)>5,Math.abs(y)>60&&(h(c),N(!0));let K=origin==="sent"?Math.min(0,y):Math.max(0,y);j.start({x:K}),R.current&&m.current&&(clearTimeout(m.current),m.current=null),d&&j.start({x:0,config:{tension:500,friction:20}})}},{eventOptions:{passive:!1}});return e.jsxs($.div,{ref:L,...M!==0||T==="imageRequest"||D==="sending"?{}:z(),style:{...G},className:`
        ${l.textMessage}
        ${D==="sending"?l.sending:l.sent}
        ${x===null?l.sentMessage:l.receivedMessage}
        ${(n==null?void 0:n.sentId)===_||(n==null?void 0:n.receivedId)===x?l.topMessage:""}
        ${(t==null?void 0:t.sentId)===_||(t==null?void 0:t.receivedId)===x?l.bottomMessage:""}
        ${f?l.repliedMessage:""}
        ${M===2?l.deletedMessage:""}
        ${k!==-1&&M!==2?l.hasReaction:""}
        ${T==="image"?l.hasImage:""}
      `,children:[(X[T]||(()=>e.jsx("p",{children:e.jsx("span",{children:"Unknown type"})})))(),M!==2&&e.jsx(me,{reaction:k,origin:_===null?"received":"sent"})]})}const ve="_replyToMessage_1hbbr_1",Ie="_sentMessage_1hbbr_20",we="_receivedMessage_1hbbr_25",b={replyToMessage:ve,sentMessage:Ie,receivedMessage:we};function Re({index:c,nextMessage:t,message:n}){const{messages:r,setMessages:f}=i.useContext(I),g=r.findIndex(s=>s.receivedId===n.replyTo.receivedId&&s.sentId===n.replyTo.sentId),u=r[g],o=()=>{setTimeout(()=>{f(s=>s.map((a,h)=>h===g?{...a,highlight:!a.highlight}:a))},100)};return e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:o,className:`
          ${b.replyToMessage}
          ${n.receivedId===null?b.sentMessage:b.receivedMessage}
          ${n.reaction!==-1?b.hasReaction:""}
        `,children:e.jsx("p",{children:u.type==="image"?"Image":u.content})}),e.jsx(H,{index:c,prevMessage:null,nextMessage:t,message:n,replied:!0},c)]})}const be="_typingIndicator_1aw03_1",Ce="_dot_1aw03_13",C={typingIndicator:be,dot:Ce};function $e({style:c}){return e.jsxs($.div,{className:C.typingIndicator,style:{...c,width:c.width.to(t=>`${t}rem`),height:c.height.to(t=>`${t}rem`)},children:[e.jsx("span",{className:C.dot}),e.jsx("span",{className:C.dot}),e.jsx("span",{className:C.dot})]})}const Ne="_newMessageContainer_hryrq_1",Te="_newMessage_hryrq_1",F={newMessageContainer:Ne,newMessage:Te};function ke({style:c}){const t=()=>{n.current.scrollIntoView({behavior:"smooth"})},{chatBottom:n}=i.useContext(I);return e.jsx("div",{className:F.newMessageContainer,children:e.jsx($.div,{className:F.newMessage,onClick:t,style:c,children:"New Message"})})}function Se(){const{messages:c,chatBottom:t,typing:n,newMessage:r,setNewMessage:f}=i.useContext(I);i.useLayoutEffect(()=>{const o=new IntersectionObserver(a=>{a.forEach(h=>{h.isIntersecting&&f(!1)})},{threshold:.1}),s=t.current;return s&&o.observe(s),()=>{s&&o.unobserve(s)}},[]);const g=O(n,{from:{width:0,height:0,opacity:0},enter:{width:4,height:2.1,opacity:1,config:v.stiff},leave:{width:0,height:0,opacity:0,config:v.stiff},onRest:()=>{Z(t)&&t.current.scrollIntoView({behavior:"smooth"})}}),u=O(r,{from:{scale:0,opacity:0},enter:{scale:1,opacity:1,config:{tension:500,friction:15}},leave:{scale:0,opacity:0,config:{tension:500,friction:20}}});return e.jsxs("div",{className:V.chatContainer,children:[c.map((o,s,a)=>o.replyTo?e.jsx(Re,{index:s,nextMessage:a[s+1],message:o},`${o.sentId}${o.receivedId}`):e.jsx(H,{index:s,prevMessage:a[s-1],nextMessage:a[s+1],message:o,replied:!1},`${o.sentId}${o.receivedId}`)),g((o,s)=>s?e.jsx($e,{style:o}):null),u((o,s)=>s?e.jsx(ke,{style:o}):null),e.jsx("div",{ref:t,className:V.chatBottom,children:"Hehe"},"chatBottom")]})}export{Se as default};
